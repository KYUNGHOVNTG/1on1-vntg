# ğŸ—ºï¸ ì„¸ì…˜ ê´€ë¦¬ ë° ë™ì‹œì ‘ì† ì œì–´ êµ¬í˜„ ë¡œë“œë§µ

## ğŸ“‹ ìš”êµ¬ì‚¬í•­
1. **15ë¶„ idle timeout í›„ ìë™ ë¡œê·¸ì•„ì›ƒ**
2. **ë™ì‹œì ‘ì† ë°©ì§€** (ë‹¤ë¥¸ ì„¸ì…˜ ë¡œê·¸ì¸ ì‹œ ê¸°ì¡´ ì„¸ì…˜ ê°•ì œ ì¢…ë£Œ)

## ğŸ¯ êµ¬í˜„ ë°©ì‹
**ë°©ë²• 2**: ê¸°ì¡´ RefreshToken í…Œì´ë¸”ì„ ì„¸ì…˜ ê´€ë¦¬ì— í™œìš© (PostgreSQL only)

---

## ğŸ“Š ì „ì²´ êµ¬ì¡° (3 Phase)

```
Phase 1: ê¸°ë³¸ ë³´ì•ˆ ì¸í”„ë¼ êµ¬ì¶• (í•„ìˆ˜ ì„ í–‰ ì‘ì—…)
  â”œâ”€ TASK 1-A: ë°±ì—”ë“œ - DB ë§ˆì´ê·¸ë ˆì´ì…˜ ë° ëª¨ë¸ ìˆ˜ì •
  â”œâ”€ TASK 1-B: ë°±ì—”ë“œ - JWT ì¸ì¦ ë¯¸ë“¤ì›¨ì–´ êµ¬í˜„
  â””â”€ TASK 1-C: í”„ë¡ íŠ¸ì—”ë“œ - API ì¸í„°ì…‰í„° ê¸°ë³¸ ë³´ì•ˆ ì„¤ì •

Phase 2: ì„¸ì…˜ ê´€ë¦¬ ë° ë™ì‹œì ‘ì† ì œì–´ (í•µì‹¬ ê¸°ëŠ¥)
  â”œâ”€ TASK 2-A: ë°±ì—”ë“œ - ì„¸ì…˜ ìƒì„± ë° ê²€ì¦ ë¡œì§
  â”œâ”€ TASK 2-B: ë°±ì—”ë“œ - ë™ì‹œì ‘ì† ì²´í¬ ë° ì„¸ì…˜ Revoke API
  â”œâ”€ TASK 2-C: í”„ë¡ íŠ¸ì—”ë“œ - ë™ì‹œì ‘ì† í™•ì¸ UX (ëª¨ë‹¬)
  â””â”€ TASK 2-D: í”„ë¡ íŠ¸ì—”ë“œ - ê°•ì œ ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬

Phase 3: Idle Timeout ë° ìµœì í™” (ì„±ëŠ¥ ë° UX)
  â”œâ”€ TASK 3-A: ë°±ì—”ë“œ - Heartbeat API ë° ë§Œë£Œ ì„¸ì…˜ ì •ë¦¬
  â”œâ”€ TASK 3-B: í”„ë¡ íŠ¸ì—”ë“œ - Activity Tracker ë° Idle Timeout
  â”œâ”€ TASK 3-C: ë°±ì—”ë“œ - DB ì¸ë±ìŠ¤ ìµœì í™” ë° ì„±ëŠ¥ íŠœë‹
  â””â”€ TASK 3-D: í†µí•© í…ŒìŠ¤íŠ¸ ë° ì‹œë‚˜ë¦¬ì˜¤ ê²€ì¦
```

---

# ğŸ”µ Phase 1: ê¸°ë³¸ ë³´ì•ˆ ì¸í”„ë¼ êµ¬ì¶•

> **ëª©í‘œ**: í˜„ì¬ TODOë¡œ ë‚¨ì•„ìˆëŠ” ê¸°ë³¸ ì¸ì¦ ê¸°ëŠ¥ êµ¬í˜„
> **ì‹œì‘ ì¡°ê±´**: ì—†ìŒ (ë°”ë¡œ ì‹œì‘ ê°€ëŠ¥)
> **ì™„ë£Œ ê¸°ì¤€**: API í˜¸ì¶œ ì‹œ JWT ê²€ì¦ ì‘ë™

---

## TASK 1-A: ë°±ì—”ë“œ - DB ë§ˆì´ê·¸ë ˆì´ì…˜ ë° ëª¨ë¸ ìˆ˜ì •

### ğŸ“ ì‘ì—… ë‚´ìš©
1. `RefreshToken` ëª¨ë¸ì— ì„¸ì…˜ ê´€ë¦¬ ì»¬ëŸ¼ ì¶”ê°€
   - `last_activity_at`: ë§ˆì§€ë§‰ í™œë™ ì‹œê°„ (idle timeout ì²´í¬ìš©)
   - `device_info`: ë””ë°”ì´ìŠ¤ ì •ë³´ (ì„ íƒ, UXìš©)
   - `ip_address`: ë¡œê·¸ì¸ IP (ì„ íƒ, ë³´ì•ˆìš©)

2. Alembic ë§ˆì´ê·¸ë ˆì´ì…˜ ìƒì„± ë° ì‹¤í–‰

3. ëª¨ë¸ í´ë˜ìŠ¤ ì—…ë°ì´íŠ¸
   - ì„¸ì…˜ ê²€ì¦ ë©”ì„œë“œ ì¶”ê°€ (`is_active()`, `is_idle()`)
   - ì„¸ì…˜ ê°±ì‹  ë©”ì„œë“œ ì¶”ê°€ (`update_activity()`)

### ğŸ“‚ ìˆ˜ì • íŒŒì¼
- `server/app/domain/auth/models.py`
- `server/alembic/versions/xxx_add_session_columns.py` (ìƒˆë¡œ ìƒì„±)

### âœ… ì™„ë£Œ ì¡°ê±´
- [ ] ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰ ì„±ê³µ
- [ ] `last_activity_at` ì»¬ëŸ¼ DBì— ì¶”ê°€ë¨
- [ ] ëª¨ë¸ ë©”ì„œë“œ êµ¬í˜„ ì™„ë£Œ

### â±ï¸ ì˜ˆìƒ ì‹œê°„: 30ë¶„

---

## TASK 1-B: ë°±ì—”ë“œ - JWT ì¸ì¦ ë¯¸ë“¤ì›¨ì–´ êµ¬í˜„

### ğŸ“ ì‘ì—… ë‚´ìš©
1. `dependencies.py`ì˜ `get_current_user_id()` êµ¬í˜„
   - JWT í† í° íŒŒì‹± ë° ê²€ì¦
   - RefreshToken í…Œì´ë¸”ì—ì„œ ì„¸ì…˜ ìœ íš¨ì„± í™•ì¸
   - `revoked_yn='N'` ì²´í¬

2. ë³´í˜¸ëœ ì—”ë“œí¬ì¸íŠ¸ì— Dependency ì ìš©
   - ê¸°ì¡´ API ë¼ìš°í„°ì— `Depends(get_current_user_id)` ì¶”ê°€
   - í…ŒìŠ¤íŠ¸ìš© ë³´í˜¸ ì—”ë“œí¬ì¸íŠ¸ ìƒì„± (`/auth/me`)

3. ì—ëŸ¬ ì‘ë‹µ í‘œì¤€í™”
   - 401: Token invalid/expired
   - 401: Session revoked (ë‹¤ë¥¸ ê³³ì—ì„œ ë¡œê·¸ì¸ë¨)

### ğŸ“‚ ìˆ˜ì • íŒŒì¼
- `server/app/core/dependencies.py`
- `server/app/domain/auth/router.py`
- `server/app/core/security.py` (í•„ìš” ì‹œ)

### âœ… ì™„ë£Œ ì¡°ê±´
- [ ] `get_current_user_id()` TODO í•´ê²°
- [ ] `/api/v1/auth/me` ì—”ë“œí¬ì¸íŠ¸ ì‘ë™ (JWT ê²€ì¦)
- [ ] ìœ íš¨í•˜ì§€ ì•Šì€ í† í° ì‹œ 401 ë°˜í™˜

### â±ï¸ ì˜ˆìƒ ì‹œê°„: 1ì‹œê°„

---

## TASK 1-C: í”„ë¡ íŠ¸ì—”ë“œ - API ì¸í„°ì…‰í„° ê¸°ë³¸ ë³´ì•ˆ ì„¤ì •

### ğŸ“ ì‘ì—… ë‚´ìš©
1. **Authorization í—¤ë” ìë™ ì¶”ê°€** (í˜„ì¬ TODO)
   - Request Interceptorì—ì„œ `localStorage.getItem('access_token')` ì½ê¸°
   - `Authorization: Bearer ${token}` í—¤ë” ì¶”ê°€

2. **401 ì—ëŸ¬ ìë™ ì²˜ë¦¬** (í˜„ì¬ TODO)
   - Response Interceptorì—ì„œ 401 ê°ì§€
   - localStorage í† í° ì‚­ì œ
   - Zustand store ì´ˆê¸°í™”
   - LoginPageë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸

3. **ì—ëŸ¬ íƒ€ì… êµ¬ë¶„**
   - `TOKEN_EXPIRED`: í† í° ë§Œë£Œ
   - `SESSION_REVOKED`: ì„¸ì…˜ ê°•ì œ ì¢…ë£Œ (ë‹¤ë¥¸ ê³³ì—ì„œ ë¡œê·¸ì¸)
   - íƒ€ì…ë³„ ë‹¤ë¥¸ ë©”ì‹œì§€ í‘œì‹œ

### ğŸ“‚ ìˆ˜ì • íŒŒì¼
- `client/src/core/api/client.ts`
- `client/src/core/api/errorHandler.ts` (í•„ìš” ì‹œ)

### âœ… ì™„ë£Œ ì¡°ê±´
- [ ] ëª¨ë“  API ìš”ì²­ì— Authorization í—¤ë” í¬í•¨
- [ ] 401 ì—ëŸ¬ ì‹œ ìë™ ë¡œê·¸ì•„ì›ƒ ë° ë¦¬ë‹¤ì´ë ‰íŠ¸
- [ ] ì—ëŸ¬ ë©”ì‹œì§€ Toastë¡œ í‘œì‹œ

### â±ï¸ ì˜ˆìƒ ì‹œê°„: 45ë¶„

---

## âœ… Phase 1 ì™„ë£Œ ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] TASK 1-A: DB ë§ˆì´ê·¸ë ˆì´ì…˜ ì™„ë£Œ
- [ ] TASK 1-B: JWT ì¸ì¦ ì‘ë™
- [ ] TASK 1-C: í”„ë¡ íŠ¸ Authorization í—¤ë” ì¶”ê°€
- [ ] **í†µí•© í…ŒìŠ¤íŠ¸**: ë¡œê·¸ì¸ í›„ API í˜¸ì¶œ ì‹œ JWT ê²€ì¦ í™•ì¸

---

# ğŸŸ¢ Phase 2: ì„¸ì…˜ ê´€ë¦¬ ë° ë™ì‹œì ‘ì† ì œì–´

> **ëª©í‘œ**: ë™ì‹œì ‘ì† ë°©ì§€ ë° ê°•ì œ ë¡œê·¸ì•„ì›ƒ êµ¬í˜„
> **ì‹œì‘ ì¡°ê±´**: Phase 1 ì™„ë£Œ
> **ì™„ë£Œ ê¸°ì¤€**: ë‹¤ë¥¸ ê¸°ê¸°ì—ì„œ ë¡œê·¸ì¸ ì‹œ ê¸°ì¡´ ì„¸ì…˜ ì¢…ë£Œ

---

## TASK 2-A: ë°±ì—”ë“œ - ì„¸ì…˜ ìƒì„± ë° ê²€ì¦ ë¡œì§

### ğŸ“ ì‘ì—… ë‚´ìš©
1. **ì„¸ì…˜ ìƒì„± ì„œë¹„ìŠ¤** (`SessionService`)
   - `create_session(user_id, device_info, ip)`: RefreshToken ë ˆì½”ë“œ ìƒì„±
   - Access Token ìƒì„± ì‹œ í•¨ê»˜ í˜¸ì¶œ

2. **ì„¸ì…˜ ê²€ì¦ ê°•í™”**
   - `dependencies.py`ì—ì„œ `last_activity_at` ì²´í¬ ì¶”ê°€
   - 15ë¶„ ì´ìƒ ê²½ê³¼ ì‹œ 401 ë°˜í™˜ (idle timeout)

3. **OAuth ì½œë°± ìˆ˜ì •**
   - ë¡œê·¸ì¸ ì„±ê³µ í›„ ì„¸ì…˜ ìƒì„±
   - `last_activity_at = NOW()`

### ğŸ“‚ ìˆ˜ì • íŒŒì¼
- `server/app/domain/auth/service.py` (SessionService ì¶”ê°€)
- `server/app/domain/auth/router.py` (OAuth ì½œë°± ìˆ˜ì •)
- `server/app/core/dependencies.py` (idle timeout ì²´í¬)

### âœ… ì™„ë£Œ ì¡°ê±´
- [ ] ë¡œê·¸ì¸ ì‹œ RefreshToken ë ˆì½”ë“œ ìƒì„±
- [ ] JWTì— `session_id` í¬í•¨ (ë˜ëŠ” refresh_token ê°’)
- [ ] Idle timeout ê²€ì¦ ì‘ë™ (í…ŒìŠ¤íŠ¸ìš© 15ì´ˆë¡œ ì„¤ì • í›„ í™•ì¸)

### â±ï¸ ì˜ˆìƒ ì‹œê°„: 1.5ì‹œê°„

---

## TASK 2-B: ë°±ì—”ë“œ - ë™ì‹œì ‘ì† ì²´í¬ ë° ì„¸ì…˜ Revoke API

### ğŸ“ ì‘ì—… ë‚´ìš©
1. **í™œì„± ì„¸ì…˜ í™•ì¸ API**
   ```
   POST /api/v1/auth/check-active-session
   Request: { user_id }
   Response: {
     has_active_session: boolean,
     session_info: { device_info, created_at, ip_address }
   }
   ```

2. **ì„¸ì…˜ ê°•ì œ ì¢…ë£Œ API**
   ```
   POST /api/v1/auth/revoke-session
   Request: { user_id, revoke_previous: boolean }
   Response: { success: boolean }
   ```

3. **OAuth ì½œë°± ìˆ˜ì •**
   - ë¡œê·¸ì¸ ì „ ê¸°ì¡´ í™œì„± ì„¸ì…˜ í™•ì¸
   - ìˆìœ¼ë©´ â†’ ì„¸ì…˜ ì •ë³´ ë°˜í™˜ (í”„ë¡ íŠ¸ì—ì„œ ì‚¬ìš©ì ì„ íƒ)
   - ì—†ìœ¼ë©´ â†’ ë°”ë¡œ ì„¸ì…˜ ìƒì„±

### ğŸ“‚ ìˆ˜ì • íŒŒì¼
- `server/app/domain/auth/router.py`
- `server/app/domain/auth/service.py`
- `server/app/domain/auth/schemas/__init__.py` (ìŠ¤í‚¤ë§ˆ ì¶”ê°€)

### âœ… ì™„ë£Œ ì¡°ê±´
- [ ] ê¸°ì¡´ í™œì„± ì„¸ì…˜ ê°ì§€
- [ ] ì„¸ì…˜ revoke ì‹œ `revoked_yn='Y'` ì—…ë°ì´íŠ¸
- [ ] OAuth ì½œë°± ì‘ë‹µì— ì„¸ì…˜ ì¶©ëŒ ì •ë³´ í¬í•¨

### â±ï¸ ì˜ˆìƒ ì‹œê°„: 2ì‹œê°„

---

## TASK 2-C: í”„ë¡ íŠ¸ì—”ë“œ - ë™ì‹œì ‘ì† í™•ì¸ UX (ëª¨ë‹¬)

### ğŸ“ ì‘ì—… ë‚´ìš©
1. **ë™ì‹œì ‘ì† í™•ì¸ ëª¨ë‹¬ ì»´í¬ë„ŒíŠ¸**
   - ì œëª©: "ë‹¤ë¥¸ ê¸°ê¸°ì—ì„œ ë¡œê·¸ì¸ ì¤‘ì…ë‹ˆë‹¤"
   - ë‚´ìš©: ê¸°ì¡´ ì„¸ì…˜ ì •ë³´ (ë””ë°”ì´ìŠ¤, ë¡œê·¸ì¸ ì‹œê°„)
   - ë²„íŠ¼:
     - "ê¸°ì¡´ ì„¸ì…˜ ì¢…ë£Œí•˜ê³  ë¡œê·¸ì¸" â†’ revoke í›„ ê³„ì†
     - "ì·¨ì†Œ" â†’ ë¡œê·¸ì¸ ì¤‘ë‹¨

2. **LoginPage ìˆ˜ì •**
   - OAuth ì½œë°± ì‘ë‹µì—ì„œ `has_active_session` ì²´í¬
   - trueë©´ ëª¨ë‹¬ í‘œì‹œ
   - ì‚¬ìš©ì ì„ íƒì— ë”°ë¼ ì²˜ë¦¬

3. **UX í”Œë¡œìš°**
   ```
   1. ë¡œê·¸ì¸ ì‹œë„
   2. ë°±ì—”ë“œ: ê¸°ì¡´ ì„¸ì…˜ ê°ì§€
   3. í”„ë¡ íŠ¸: ëª¨ë‹¬ í‘œì‹œ
   4. ì‚¬ìš©ì: "ê¸°ì¡´ ì„¸ì…˜ ì¢…ë£Œ" ì„ íƒ
   5. í”„ë¡ íŠ¸: POST /auth/revoke-session
   6. ë°±ì—”ë“œ: ê¸°ì¡´ ì„¸ì…˜ revoke
   7. í”„ë¡ íŠ¸: ì¬ë¡œê·¸ì¸ ì‹œë„
   8. ë°±ì—”ë“œ: ìƒˆ ì„¸ì…˜ ìƒì„±
   9. ì™„ë£Œ
   ```

### ğŸ“‚ ìˆ˜ì •/ìƒì„± íŒŒì¼
- `client/src/domains/auth/components/SessionConflictModal.tsx` (ìƒˆë¡œ ìƒì„±)
- `client/src/domains/auth/pages/LoginPage.tsx`
- `client/src/domains/auth/api.ts` (revoke API ì¶”ê°€)

### âœ… ì™„ë£Œ ì¡°ê±´
- [ ] ë™ì‹œì ‘ì† ì‹œ ëª¨ë‹¬ í‘œì‹œ
- [ ] "ê¸°ì¡´ ì„¸ì…˜ ì¢…ë£Œ" ì„ íƒ ì‹œ ì •ìƒ ë¡œê·¸ì¸
- [ ] "ì·¨ì†Œ" ì„ íƒ ì‹œ ë¡œê·¸ì¸ ì¤‘ë‹¨

### â±ï¸ ì˜ˆìƒ ì‹œê°„: 2ì‹œê°„

---

## TASK 2-D: í”„ë¡ íŠ¸ì—”ë“œ - ê°•ì œ ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬

### ğŸ“ ì‘ì—… ë‚´ìš©
1. **ì„¸ì…˜ ê°•ì œ ì¢…ë£Œ ê°ì§€**
   - API 401 ì‘ë‹µì—ì„œ `error_code: "SESSION_REVOKED"` êµ¬ë¶„
   - ì¼ë°˜ í† í° ë§Œë£Œì™€ ë‹¤ë¥¸ ë©”ì‹œì§€ í‘œì‹œ

2. **ê°•ì œ ë¡œê·¸ì•„ì›ƒ ì•Œë¦¼**
   - Toast ë©”ì‹œì§€: "ë‹¤ë¥¸ ê¸°ê¸°ì—ì„œ ë¡œê·¸ì¸í•˜ì—¬ í˜„ì¬ ì„¸ì…˜ì´ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤"
   - 2ì´ˆ í›„ ìë™ìœ¼ë¡œ ë¡œê·¸ì¸ í˜ì´ì§€ ì´ë™

3. **ì—ëŸ¬ í•¸ë“¤ëŸ¬ ìˆ˜ì •**
   - `ApiErrorHandler`ì—ì„œ 401 ì—ëŸ¬ íƒ€ì… êµ¬ë¶„
   - `SESSION_REVOKED` vs `TOKEN_EXPIRED`

### ğŸ“‚ ìˆ˜ì • íŒŒì¼
- `client/src/core/api/client.ts` (Response Interceptor)
- `client/src/core/api/errorHandler.ts`

### âœ… ì™„ë£Œ ì¡°ê±´
- [ ] Device A ë¡œê·¸ì¸ â†’ Device B ë¡œê·¸ì¸ â†’ Device A ê°•ì œ ë¡œê·¸ì•„ì›ƒ
- [ ] Device Aì—ì„œ "ë‹¤ë¥¸ ê³³ì—ì„œ ë¡œê·¸ì¸ë¨" ë©”ì‹œì§€ í‘œì‹œ
- [ ] ìë™ìœ¼ë¡œ ë¡œê·¸ì¸ í˜ì´ì§€ ì´ë™

### â±ï¸ ì˜ˆìƒ ì‹œê°„: 1ì‹œê°„

---

## âœ… Phase 2 ì™„ë£Œ ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] TASK 2-A: ì„¸ì…˜ ìƒì„± ì‘ë™
- [ ] TASK 2-B: ë™ì‹œì ‘ì† ê°ì§€ ë° revoke
- [ ] TASK 2-C: ë™ì‹œì ‘ì† ëª¨ë‹¬ UX
- [ ] TASK 2-D: ê°•ì œ ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬
- [ ] **í†µí•© í…ŒìŠ¤íŠ¸**: 2ê°œ ë¸Œë¼ìš°ì €ì—ì„œ ë™ì‹œì ‘ì† ì‹œë‚˜ë¦¬ì˜¤ ê²€ì¦

---

# ğŸŸ£ Phase 3: Idle Timeout ë° ìµœì í™”

> **ëª©í‘œ**: 15ë¶„ idle timeout + ì„±ëŠ¥ ìµœì í™”
> **ì‹œì‘ ì¡°ê±´**: Phase 2 ì™„ë£Œ
> **ì™„ë£Œ ê¸°ì¤€**: 1200ëª… ê·œëª¨ ëŒ€ë¹„ ì„±ëŠ¥ í™•ë³´

---

## TASK 3-A: ë°±ì—”ë“œ - Heartbeat API ë° ë§Œë£Œ ì„¸ì…˜ ì •ë¦¬

### ğŸ“ ì‘ì—… ë‚´ìš©
1. **Heartbeat API**
   ```
   POST /api/v1/auth/session/heartbeat
   Request: (JWTì—ì„œ user_id ì¶”ì¶œ)
   Response: { success: boolean, last_activity_at: datetime }
   ```
   - `last_activity_at` í˜„ì¬ ì‹œê°„ìœ¼ë¡œ ì—…ë°ì´íŠ¸
   - ì“°ë¡œí‹€ë§ ì ìš© (1ë¶„ ì´ë‚´ ì¤‘ë³µ ìš”ì²­ ë¬´ì‹œ)

2. **ë§Œë£Œ ì„¸ì…˜ ìë™ ì •ë¦¬ í¬ë¡ ì¡**
   - APScheduler ì„¤ì •
   - ë§¤ 10ë¶„ë§ˆë‹¤ ì‹¤í–‰
   - 15ë¶„ ì´ìƒ í™œë™ ì—†ëŠ” ì„¸ì…˜ `revoked_yn='Y'`

3. **ì„¸ì…˜ í†µê³„ API** (ì„ íƒ)
   ```
   GET /api/v1/auth/session/stats
   Response: { active_sessions: 123, idle_sessions: 45 }
   ```

### ğŸ“‚ ìˆ˜ì •/ìƒì„± íŒŒì¼
- `server/app/domain/auth/router.py` (heartbeat API)
- `server/app/core/scheduler.py` (ìƒˆë¡œ ìƒì„±, í¬ë¡ ì¡)
- `server/requirements.txt` (APScheduler ì¶”ê°€)

### âœ… ì™„ë£Œ ì¡°ê±´
- [ ] Heartbeat API ì‘ë™ (1ë¶„ ì“°ë¡œí‹€ë§)
- [ ] í¬ë¡ ì¡ìœ¼ë¡œ ë§Œë£Œ ì„¸ì…˜ ìë™ ì •ë¦¬
- [ ] ë¡œê·¸ì—ì„œ ì •ë¦¬ëœ ì„¸ì…˜ ìˆ˜ í™•ì¸

### â±ï¸ ì˜ˆìƒ ì‹œê°„: 1.5ì‹œê°„

---

## TASK 3-B: í”„ë¡ íŠ¸ì—”ë“œ - Activity Tracker ë° Idle Timeout

### ğŸ“ ì‘ì—… ë‚´ìš©
1. **Activity Tracker Hook** (`useActivityTracker`)
   - ë§ˆìš°ìŠ¤ ì´ë™, í´ë¦­, í‚¤ë³´ë“œ ì…ë ¥ ê°ì§€
   - 1ë¶„ë§ˆë‹¤ `/session/heartbeat` í˜¸ì¶œ (ë°±ê·¸ë¼ìš´ë“œ)
   - 14ë¶„ ê²½ê³¼ ì‹œ ê²½ê³  ëª¨ë‹¬

2. **Idle Timeout ê²½ê³  ëª¨ë‹¬**
   - ì œëª©: "ì„¸ì…˜ ë§Œë£Œ ì˜ˆì •"
   - ë‚´ìš©: "1ë¶„ í›„ ìë™ ë¡œê·¸ì•„ì›ƒë©ë‹ˆë‹¤. ê³„ì† ì‚¬ìš©í•˜ì‹œê² ìŠµë‹ˆê¹Œ?"
   - ë²„íŠ¼: "ê³„ì† ì‚¬ìš©" (heartbeat í˜¸ì¶œ)

3. **ìë™ ë¡œê·¸ì•„ì›ƒ**
   - 15ë¶„ idle ì‹œ ìë™ ë¡œê·¸ì•„ì›ƒ
   - Toast: "ì¥ì‹œê°„ ì‚¬ìš©í•˜ì§€ ì•Šì•„ ìë™ ë¡œê·¸ì•„ì›ƒë˜ì—ˆìŠµë‹ˆë‹¤"

### ğŸ“‚ ìˆ˜ì •/ìƒì„± íŒŒì¼
- `client/src/core/hooks/useActivityTracker.ts` (ìƒˆë¡œ ìƒì„±)
- `client/src/core/components/IdleTimeoutModal.tsx` (ìƒˆë¡œ ìƒì„±)
- `client/src/App.tsx` (Activity Tracker ì ìš©)

### âœ… ì™„ë£Œ ì¡°ê±´
- [ ] í™œë™ ê°ì§€ ì‘ë™
- [ ] 1ë¶„ë§ˆë‹¤ heartbeat í˜¸ì¶œ
- [ ] 14ë¶„ ê²½ê³¼ ì‹œ ê²½ê³  ëª¨ë‹¬
- [ ] 15ë¶„ idle ì‹œ ìë™ ë¡œê·¸ì•„ì›ƒ

### â±ï¸ ì˜ˆìƒ ì‹œê°„: 2.5ì‹œê°„

---

## TASK 3-C: ë°±ì—”ë“œ - DB ì¸ë±ìŠ¤ ìµœì í™” ë° ì„±ëŠ¥ íŠœë‹

### ğŸ“ ì‘ì—… ë‚´ìš©
1. **ì¸ë±ìŠ¤ ìƒì„±**
   ```sql
   CREATE INDEX idx_refresh_token_user_active
   ON auth_refresh_token(user_id, revoked_yn, last_activity_at)
   WHERE revoked_yn = 'N';

   CREATE INDEX idx_refresh_token_cleanup
   ON auth_refresh_token(last_activity_at)
   WHERE revoked_yn = 'N';
   ```

2. **ì¿¼ë¦¬ ìµœì í™”**
   - ì„¸ì…˜ ì¡°íšŒ ì¿¼ë¦¬ EXPLAIN ANALYZE
   - N+1 ë¬¸ì œ í™•ì¸
   - SELECT FOR UPDATE í•„ìš” ì‹œ ì ìš©

3. **Connection Pool íŠœë‹**
   - `DB_POOL_SIZE`: 5 â†’ 10 (1200ëª… ëŒ€ë¹„)
   - `DB_MAX_OVERFLOW`: 10 â†’ 20

### ğŸ“‚ ìˆ˜ì • íŒŒì¼
- `server/alembic/versions/xxx_add_session_indexes.py` (ìƒˆë¡œ ìƒì„±)
- `server/app/core/config.py` (Pool ì„¤ì •)

### âœ… ì™„ë£Œ ì¡°ê±´
- [ ] ì¸ë±ìŠ¤ ìƒì„± ì™„ë£Œ
- [ ] ì„¸ì…˜ ì¡°íšŒ ì¿¼ë¦¬ < 10ms
- [ ] EXPLAIN ANALYZE ê²°ê³¼ Index Scan ì‚¬ìš©

### â±ï¸ ì˜ˆìƒ ì‹œê°„: 1ì‹œê°„

---

## TASK 3-D: í†µí•© í…ŒìŠ¤íŠ¸ ë° ì‹œë‚˜ë¦¬ì˜¤ ê²€ì¦

### ğŸ“ ì‘ì—… ë‚´ìš©
1. **ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤**
   - [ ] ë¡œê·¸ì¸ â†’ 15ë¶„ idle â†’ ìë™ ë¡œê·¸ì•„ì›ƒ
   - [ ] ë¡œê·¸ì¸ â†’ 14ë¶„ idle â†’ ê²½ê³  â†’ "ê³„ì† ì‚¬ìš©" â†’ ì„¸ì…˜ ìœ ì§€
   - [ ] Device A ë¡œê·¸ì¸ â†’ Device B ë¡œê·¸ì¸ â†’ A ê°•ì œ ì¢…ë£Œ
   - [ ] ë¸Œë¼ìš°ì € ìƒˆë¡œê³ ì¹¨ â†’ ì„¸ì…˜ ìœ ì§€
   - [ ] ë„¤íŠ¸ì›Œí¬ ëŠê¹€ â†’ ì¬ì—°ê²° â†’ heartbeat ì¬ì‹œë„

2. **ì—£ì§€ì¼€ì´ìŠ¤ í…ŒìŠ¤íŠ¸**
   - [ ] ë¡œê·¸ì•„ì›ƒ í›„ ë’¤ë¡œê°€ê¸°
   - [ ] ì—¬ëŸ¬ íƒ­ì—ì„œ ë™ì‹œ ë¡œê·¸ì¸ (ê°™ì€ ë¸Œë¼ìš°ì €)
   - [ ] ì„¸ì…˜ ë§Œë£Œ ì¤‘ API í˜¸ì¶œ
   - [ ] Heartbeat ì‹¤íŒ¨ ì‹œ fallback

3. **ì„±ëŠ¥ í…ŒìŠ¤íŠ¸**
   - [ ] ë™ì‹œ ì‚¬ìš©ì 100ëª… ì‹œë®¬ë ˆì´ì…˜
   - [ ] DB ì¿¼ë¦¬ ì‘ë‹µ ì‹œê°„ < 100ms
   - [ ] Heartbeat ë¶€í•˜ í…ŒìŠ¤íŠ¸

4. **ë²„ê·¸ ìˆ˜ì •**
   - ë°œê²¬ëœ ì´ìŠˆ ìˆ˜ì •
   - ë¡œê·¸ ì •ë¦¬

### ğŸ“‚ ìˆ˜ì • íŒŒì¼
- í•„ìš” ì‹œ ë²„ê·¸ ìˆ˜ì •

### âœ… ì™„ë£Œ ì¡°ê±´
- [ ] ëª¨ë“  ì‹œë‚˜ë¦¬ì˜¤ í†µê³¼
- [ ] ì—£ì§€ì¼€ì´ìŠ¤ ì²˜ë¦¬ ì™„ë£Œ
- [ ] ì„±ëŠ¥ ê¸°ì¤€ ì¶©ì¡±

### â±ï¸ ì˜ˆìƒ ì‹œê°„: 3ì‹œê°„

---

## âœ… Phase 3 ì™„ë£Œ ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] TASK 3-A: Heartbeat ë° ìë™ ì •ë¦¬
- [ ] TASK 3-B: Activity Tracker ë° ê²½ê³ 
- [ ] TASK 3-C: DB ì¸ë±ìŠ¤ ìµœì í™”
- [ ] TASK 3-D: ì „ì²´ ì‹œë‚˜ë¦¬ì˜¤ ê²€ì¦
- [ ] **ìµœì¢… ê²€ìˆ˜**: ìš”êµ¬ì‚¬í•­ ì¶©ì¡± í™•ì¸

---

# ğŸ“Š ì „ì²´ ì§„í–‰ ìƒí™© ì¶”ì 

## Phaseë³„ ì§„í–‰ë¥ 

| Phase | Task ìˆ˜ | ì™„ë£Œ | ì§„í–‰ë¥  | ìƒíƒœ |
|-------|---------|------|--------|------|
| Phase 1 | 3 | 0 | 0% | â¬œ Not Started |
| Phase 2 | 4 | 0 | 0% | â¬œ Not Started |
| Phase 3 | 4 | 0 | 0% | â¬œ Not Started |
| **ì „ì²´** | **11** | **0** | **0%** | â¬œ Not Started |

## ì˜ˆìƒ ì¼ì •

| Phase | ì˜ˆìƒ ì‹œê°„ | ì‹¤ì œ ì‹œê°„ | ì™„ë£Œ ì˜ˆì •ì¼ |
|-------|----------|----------|------------|
| Phase 1 | 2.5ì‹œê°„ | - | - |
| Phase 2 | 6.5ì‹œê°„ | - | - |
| Phase 3 | 8ì‹œê°„ | - | - |
| **ì „ì²´** | **17ì‹œê°„ (ì•½ 2-3ì¼)** | - | - |

---

# ğŸ¯ ì‹œì‘ ê°€ì´ë“œ

## ì²« ë²ˆì§¸ ì‘ì—…

**TASK 1-Aë¶€í„° ì‹œì‘í•˜ì„¸ìš”** (í•„ìˆ˜ ì„ í–‰ ì‘ì—…)

```bash
# ìš”ì²­ ì˜ˆì‹œ
"TASK 1-Aë¥¼ ì§„í–‰í•´ì¤˜: RefreshToken í…Œì´ë¸”ì— ì„¸ì…˜ ê´€ë¦¬ ì»¬ëŸ¼ ì¶”ê°€"
```

## ì‘ì—… ìˆœì„œ (ì˜ì¡´ì„±)

```
TASK 1-A (DB)
  â†“
TASK 1-B (ë°±ì—”ë“œ ì¸ì¦)
  â†“
TASK 1-C (í”„ë¡ íŠ¸ ì¸ì¦) â†’ Phase 1 ì™„ë£Œ ì²´í¬
  â†“
TASK 2-A (ì„¸ì…˜ ìƒì„±)
  â†“
TASK 2-B (ë™ì‹œì ‘ì† API)
  â†“
TASK 2-C (ë™ì‹œì ‘ì† UX)
  â†“
TASK 2-D (ê°•ì œ ë¡œê·¸ì•„ì›ƒ) â†’ Phase 2 ì™„ë£Œ ì²´í¬
  â†“
TASK 3-A (Heartbeat)
  â†“
TASK 3-B (Activity Tracker)
  â†“
TASK 3-C (ìµœì í™”)
  â†“
TASK 3-D (í…ŒìŠ¤íŠ¸) â†’ ì „ì²´ ì™„ë£Œ
```

---

# ğŸ“ ê° ì‘ì—… ì‹œì‘ ì‹œ ìš”ì²­ í…œí”Œë¦¿

```
TASK X-Yë¥¼ ì‹œì‘í•´ì¤˜

[ì´ì „ ì‘ì—… ì™„ë£Œ ì—¬ë¶€ í™•ì¸]
[í•´ë‹¹ Task ì‘ì—… ì§„í–‰]
[ì™„ë£Œ í›„ ë‹¤ìŒ Task ì•ˆë‚´]
```

---

# âœ… ì™„ë£Œ ê¸°ì¤€ ì²´í¬ë¦¬ìŠ¤íŠ¸

## ìš”êµ¬ì‚¬í•­ ì¶©ì¡±ë„

- [ ] **15ë¶„ idle timeout**: í™œë™ ì—†ìœ¼ë©´ ìë™ ë¡œê·¸ì•„ì›ƒ
- [ ] **ë™ì‹œì ‘ì† ë°©ì§€**: ë‹¤ë¥¸ ê¸°ê¸° ë¡œê·¸ì¸ ì‹œ ê¸°ì¡´ ì„¸ì…˜ ì¢…ë£Œ
- [ ] **ë³´ì•ˆ ê°•í™”**: Authorization í—¤ë”, JWT ê²€ì¦
- [ ] **UX**: ëª…í™•í•œ ì•Œë¦¼ ë° ëª¨ë‹¬
- [ ] **ì„±ëŠ¥**: 1200ëª… ëŒ€ì‘ ê°€ëŠ¥
- [ ] **ì•ˆì •ì„±**: ì—£ì§€ì¼€ì´ìŠ¤ ì²˜ë¦¬

## ìµœì¢… ê²€ìˆ˜ í•­ëª©

- [ ] ëª¨ë“  TASK ì™„ë£Œ
- [ ] ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸ í†µê³¼
- [ ] ì„±ëŠ¥ ê¸°ì¤€ ì¶©ì¡± (ì‘ë‹µ < 100ms)
- [ ] ì½”ë“œ ë¦¬ë·° ì™„ë£Œ
- [ ] ë¬¸ì„œí™” (API ìŠ¤í™, ë°°í¬ ê°€ì´ë“œ)

---

**ì¤€ë¹„ ì™„ë£Œ! TASK 1-Aë¶€í„° ì‹œì‘í•˜ì‹œê² ìŠµë‹ˆê¹Œ?**
